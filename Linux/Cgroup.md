## **什么是 Cgroup？**

Linux 内核负责系统上所有硬件的可靠交互。这意味着，除了使操作系统（OS）能够理解硬件的代码位（驱动程序）之外，它还限制了特定程序可以从系统中获取多少资源。系统必须将系统内存分配给计算机可能执行的所有应用程序。Linux 系统可以无限制地运行大多数应用程序。但是，如果某个程序中存在错误，并且它开始占用所有可用内存，会怎么样呢？内核有一个叫做 OOM（Out Of Memory） Killer 的功能。它能在系统崩溃之前停止应用程序以释放足够的 RAM，以使操作系统能够继续正常运行。因此，OOM 进程在系统崩溃之前充当了最后一道防线，有时很有用。但是由于内核可以控制哪些进程能够幸免于 OOM，它也可以确定哪些应用程序从一开始就不应消耗过多的内存。

而 Cgroup 是内核内置的一种设施，允许管理员在系统上设置任何进程的资源利用限制。一般来说，Cgroup 主要控制：

- 每个进程的 CPU 份额数量。
- 每个进程的内存限制。
- 每个进程的块设备 I/O。
- 哪些网络数据包被识别为同一类型，以便其他应用程序可以强制执行网络流量规则。

## **Cgroup 是如何工作的？**

Cgroup 是一种控制内核中某些子系统的机制。这些子系统，如设备、CPU、RAM、网络访问等，被称为 Cgroup 术语中的控制器。每种类型的控制器（`cpu`、`blkio`、`memory`等）都被细分为一个类似树形结构。每个分支或叶子都有自己的权重或限制。一个控制组有多个与之关联的进程，使得资源利用可以细粒度调整，易于微调。

![img](/Users/hanguobiao/Nutstore Files/读书笔记/Linux/Cgroup.assets/v2-9c98d3db7d482ebde145b6a1981eca23_1440w.jpg)

在上面的图表中，你可以看到一个进程（PID 1）可以属于 `memory`、`disk i/o` 和`cpu` 控制组。Cgroup 是按资源类型创建的，彼此之间没有关联。所以你可以在所有控制器中关联一个 `database` 组，但这些组是相互独立的。就像 GID 一样，这些组在创建时被分配到一个数字值，而不是友好名称。在内核中，这些值用于确定资源分配。换句话说，假设每个附加到控制器的 Cgroup 名称在附加后被重命名为控制器的名称加上你选择的名称。那么在 `memory` 控制器中的 `database` 组可以被称为 `memory-database`。它与控制器 `cpu` 关联的 `database` 组没有关系，因为它的名称是 `cpu-database`。